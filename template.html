#if($products.size() > 0)
#set($firstbreakpoint = $props.mobile.showThreeWhen + "px")
#set($secondbreakpoint = $props.mobile.showTwoWhen + "px")
#set($imgCount = 0)
#set($prdCount = 1)
<style>
    #$divId{
    #if($!props.display.maxWidth)
    max-width: $!props.display.maxWidth;
    #else
    max-width: 1300px;
    #end
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    margin: 0 auto;
    }
    #$divId .li-after{
    line-height: 130px;
    font-size:30px;
    float:left;
    }
    #$divId .li-price{
    font-size:30px;
    float:right;
    }
    #$divId .nosto-total-price{
    font-size:25px;
    color: #DA001F !important;
    }
    #$divId .products-bottom-nosto{
    clear:both;
    }
    #$divId .nosto-product-desc-block{
    clear:both;
    }
    #$divId .nosto-btn-cart{
    background: #da001f;
    color: white;
    padding: 10px 30px;
    font-size: 1.3rem;
    margin-top:20px;
    }
    #$divId .total{
    margin-top:10px;
    }
    #$divId .nosto-product-name , #$divId .nosto-checkBox{
    margin-right:10px !important;
    }
    .nosto-product-desc-block .nosto-product-name, .nosto-product-desc-block .saa-price , .nosto-product-desc-block .nosto-checkBox{
    float:left;
    }
    #$divId .nosto-block{
    clear:both;
    color: #1a1a1a;
    font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
    width: 100%;
    padding-top: 10px;
    padding-bottom: 10px;
    margin: 0 auto;
    display: inline-block;
    }
    .total{
    font-size:15px;
    }
    #$divId .saa-price , .total-price{
    color:#DA001F !important;
    text-align: left;
    float: left;
    margin-top: -3px;
    }
    #$divId .nosto-block, #$divId .nosto-block a, #$divId .nosto-block span{
    color: #1a1a1a;
    text-decoration: none;
    text-rendering: optimizeLegibility;
    }
    /* HEADER STYLE */
    #$divId .nosto-header{
    background-color: transparent;
    #if($!props.colors.headingTextColor)
    color: $!props.colors.headingTextColor !important;
    #else
    color: #1a1a1a;
    #end
    display: block;
    padding: 20px 0;
    #if($!props.fonts.headingTextFontFamily)
    font-family: $!props.fonts.headingTextFontFamily !important;
    #else
    font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;
    #end
    border: none;
    text-align: center;
    #if($!props.fonts.headingTextFontSize)
    font-size: $!props.fonts.headingTextFontSize;
    #else
    font-size: 20px;
    #end
    font-weight: 200;
    margin: ;
    }
    #$divId .nosto-list{
    margin: 0px;
    padding: 0px;
    border: 0px;
    list-style: none;
    width: 100%;
    }
    #$divId .nosto-link{
    text-decoration: none !important;
    }
    /* STYLING FOR THE ELEMENT OF THE LIST */
    #$divId .nosto-list-item{
    background-color: transparent;
    margin: 0;
    border: 1px solid transparent;
    margin-bottom: -10px !important;
    float: left;
    letter-spacing: 0;
    word-spacing: 0;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
    vertical-align: top;
    position: relative;
    }
    #$divId .nosto-list-item:first-child{
    margin-left: 0 !important;
    }
    #$divId .nosto-list-item:last-child{
    margin-right: 0 !important;
    }
    /* HOVERING EFFECT ON PRODUCT, THAT CAN BE ACTIVATED/DEACTIVATED FROM THE UI */
    #$divId .nosto-hover{
    width: 100%;
    height: 100%;
    background: rgba(182,0,149,0.7);
    position: absolute;
    display: none;
    }
    /* CSS FOR RIBBON STYLE - LABEL ON THE RIGHT */
    #if($!props.ribbon.ribbonOn)
    #$divId .nosto-ribbon{
    text-align: center;
    #if($!props.colors.ribbonColor)
    background-color: $!props.colors.ribbonColor;
    #else
    background-color: #00BFFF;
    #end
    opacity: 1;
    font-family: 'Open Sans', sans-serif;
    line-height: 20px;
    color: white;
    position: absolute;
    padding: 5px;
    border-radius: 2px;
    right: 5px;
    top: 5px;
    font-size: 12px;
    z-index: 5;
    }
    #end
    /* STYLE FOR IMAGE CONTAINER AND IMAGES WITHIN EACH RECOMMENDATION BLOCK */
    #$divId .nosto-image-container{
    width: 100%;
    #if($!props.display.imageHeight)
    height: $!props.display.imageHeight;
    #else
    height: 200px;
    #end
    display: block;
    position: relative;
    }
    #$divId .nosto-image{
    max-width: 100%;
    max-height: 100%;
    display: block;
    border: none !important;
    position: absolute;
    top:0;
    bottom:0;
    left:0;
    right: 0;
    margin: auto;
    }
    /* FROM HERE, STYLING FOR PRODUCT INFORMATION'S TYPOS */
    #$divId .nosto-product-info{
    #if($!props.display.productInfoTextAlign)
    text-align: $!props.display.productInfoTextAlign;
    #else
    text-align: center;
    #end
    #if($!props.colors.priceInfoTextColor)
    color: $!props.colors.priceInfoTextColor;
    #end
    margin-top: 15px;
    font-family: 'Open Sans', sans-serif;
    }
    #$divId .nosto-product-brand{
    font-weight: bold;
    display: block;
    font-weight: normal;
    margin-bottom: 0;
    }
    #$divId .nosto-product-name{
    min-height: 20px;
    font-weight: normal;
    display: block;
    -webkit-transition: color 30ms linear, color 0.2s linear;
    -moz-transition: color 30ms linear, color 0.2s linear;
    -o-transition: color 30ms linear, color 0.2s linear;
    -ms-transition: color 30ms linear, color 0.2s linear;
    transition: color 30ms linear, color 0.2s linear;
    margin-bottom: 10px;
    text-align: left;
    }
    #$divId .nosto-product-price{
    margin-top: 10px;
    display: inline-block;
    font-weight: normal;
    float: left;
    }
    #$divId .nosto-product-price .nosto-oldprice{
    float: left;
    text-decoration: line-through;
    font-style: italic;
    }
    #$divId .nosto-product-price .nosto-newprice{
    float: left;
    margin-left: 10px;
    #if($!props.colors.discountedPriceTextColor)
    color: $!props.colors.discountedPriceTextColor !important;
    #else
    color: #ce3535;
    #end
    font-weight: bold;
    }
    #$divId .nosto-rating{
    display: block;
    width: 100%;
    }
    #$divId .nosto-rating span.nosto-star-full, #$divId .nosto-rating span.nosto-star-empty {
    display: inline-block;
    position: relative;
    width: 0.8em;
    }
    #$divId .nosto-rating span.nosto-star-full{
    #if($!props.colors.reviewsFullStarColor)
    color: $!props.colors.reviewsFullStarColor;
    #else
    color: #E5CD00;
    #end
    }
    #$divId .nosto-rating span.nosto-star-empty{
    color: #cdcdcd;
    }
    #$divId .nosto-reviews{
    font-weight: normal;
    font-size: 13px;
    display: block;
    width: 100%;
    }
    /* BREAKPOINTS CASES AND FALLBACK */
    #if($!props.mobile.mobileView)  /* DEACTIVATE MEDIA QUERIES IF BREAKPOINTS ARE DISABLED */
    @media (min-width: $firstbreakpoint) {
    #end
    #if($props.display.productsPerRow == 6)
    #$divId .nosto-list-item{
    width: 14%;
    margin: 0 1.6%;
    }
    #elseif($props.display.productsPerRow == 5)
    #$divId .nosto-list-item{
    width: 18%;
    margin: 0 1.25%;
    }
    #elseif($props.display.productsPerRow == 4)
    #$divId .nosto-list-item{
    width: 22%;
    margin: 0 2%;
    }
    #elseif($props.display.productsPerRow == 3)
    #$divId .nosto-list-item{
    width: 20%;
    margin: 0 2.5%;
    }
    #elseif($props.display.productsPerRow == 2)
    #$divId .nosto-list-item{
    width: 44%;
    margin: 0 6%;
    }
    #elseif($props.display.productsPerRow == 7)
    #$divId .nosto-list-item{
    width: 13%;
    margin: 0 0.75%;
    }
    #else
    #$divId .nosto-list-item{
    width: 11%;
    margin: 0 0.85714%;
    }
    #end
    #set($odd = $props.display.productsPerRow + "n+1")
    #set($odd = $odd.toString())
    #set($even = $props.display.productsPerRow + "n+0")
    #set($even = $even.toString())
    #$divId .nosto-list-item:nth-child($odd){
    margin-left: 0;
    clear: left;
    }
    #$divId .nosto-list-item:nth-child($even){
    margin-right: 0;
    }
    #if($!props.mobile.mobileView)  /* CLOSE IF FOR MEDIA QUERIES */
    }
    #end
    #if($props.mobile.mobileView)
    @media (max-width: $firstbreakpoint) and (min-width: $secondbreakpoint) {
    #$divId .nosto-list-item{
    width: 30%;
    margin: 0 2.5%;
    }
    #$divId .nosto-list-item:nth-child(3n+0){
    margin-right: 0 !important;
    }
    #$divId .nosto-list-item:nth-child(3n+1){
    margin-left: 0 !important;
    clear: left;
    }
    }
    @media (max-width: $secondbreakpoint) {
    #$divId .nosto-list-item{
    width: 46%;
    margin: 0 4%;
    }
    #$divId .nosto-list-item:nth-child(2n+0){
    margin-right: 0 !important;
    }
    #$divId .nosto-list-item:nth-child(2n+1){
    margin-left: 0 !important;
    clear: left;
    }
    #set($selector = $!props.mobile.recsOnMobile + 1)
    #set($breakpoint = "n+" + $selector)
    #set($breakpoint = $breakpoint.toString())
    #$divId .nosto-list-item:nth-child($breakpoint){
    display: none !important;
    }
    }
    #$divId .nosto-btn {
    background: #da001f;
    color: white;
    padding: 5px 10px;
    font-size: 1.2rem;
    text-decoration: none;
    -webkit-appearance: none;
    display: block;
    cursor:pointer;
    border-radius: 5px;
    line-height: 20px;
    font-weight: 400;
    float: right;
    margin-top: 10px;
    border: 0;
    }
    #$divId .nosto-btn:hover {
    background: #ce3535;
    color: white;
    text-decoration: none;
    }
    .col-md-9  #$divId .nosto-btn {
    float: left;
    margin-top: 0;
    }
    #end
</style>
<div class="nosto-block">
    <h4 class="nosto-header">$!title</h4>
    <div class="nosto-container block-border-bottom">
        <form action="addmulti/addtocart/" method="post" id="recom_form">
            <ul class="nosto-list">
                #foreach($product in $products)
                <li class="nosto-list-item">
                    #if($!props.ribbon.ribbonOn && $!prdCount > 1)
                    #if($!product.discounted && $!props.ribbon.percentageDiscountOn)
                    <div class="nosto-ribbon">-$!product.discount.percent%</div>
                    #elseif($product.mostBought && $!props.ribbon.mostBoughtOn)
                    <div class="nosto-ribbon">$!props.ribbon.mostBoughtCopy</div>
                    #elseif($product.mostViewed && $!props.ribbon.mostViewedOn)
                    <div class="nosto-ribbon">$!props.ribbon.mostViewedCopy</div>
                    #elseif($product.ageInDays <= $props.ribbon.newInDays && $!props.ribbon.newInOn)
                    <div class="nosto-ribbon">$!props.ribbon.newInCopy</div>
                    #end
                    #end
                    <style>
                        #if($!props.display.showAlternateImages && $!product.alternateImageUrls && $!product.alternateImageUrls.size() > 0)
                        #$divId .img-$imgCount:before, #$divId .img-$imgCount:after {
                        content: "";
                        position: absolute;
                        background-position: center center;
                        top: 0px;
                        right: 0px;
                        bottom: 0px;
                        left: 0px;
                        opacity: 1;
                        z-index: 1;
                        }
                        #$divId .img-$imgCount:before {
                        #if($!props.display.imageFormat && $!props.display.imageFormat != 0)
                        background-image: url('$!product.thumb($!props.display.imageFormat)');
                        #elseif($!props.display.imageFormat && $!props.display.imageFormat == 0)
                        background-image: url('$!product.imageUrl'));
                        #else
                        background-image: url('$!product.thumb(8)'));
                        #end
                        background-size: contain !important;
                        background-repeat: no-repeat;
                        transition: opacity 0.3s;
                        z-index: 2;
                        }
                        #$divId .img-$imgCount:after{
                        background-image: url('$!product.alternateImageUrls[0]');
                        background-size: contain !important;
                        background-repeat: no-repeat;
                        opacity: 0;
                        transition: opacity 0.3s;
                        }
                        #$divId .img-$imgCount:hover:before{
                        opacity: 0;
                        }
                        #$divId .img-$imgCount:hover:after{
                        opacity: 1;
                        }
                        #else
                        #$divId .img-$imgCount{
                        #if($!props.display.imageFormat && $!props.display.imageFormat != 0)
                        background-image: url('$!product.thumb($!props.display.imageFormat)');
                        #elseif($!props.display.imageFormat && $!props.display.imageFormat == 0)
                        background-image: url('$!product.imageUrl'));
                        #else
                        background-image: url('$!product.thumb(7)'));
                        #end
                        background-position: center center;
                        background-repeat: no-repeat;
                        background-size: contain !important;
                        }
                        #end
                    </style>
                    <a href="$!product.url" alt="$!product.name">
                        <div class="nosto-image-container img-$imgCount"></div>
                    </a>
                    #if($!props.display.showBuyButton)
                    #if($product.tags1Contains("add-to-cart"))
                    <button onclick="Nosto.addProductToCart('$!product.productId', this); return false;" class="nosto-btn">$!props.display.buyButtonCopy</button>
                    #end
                    #end
                </li>
                #if($prdCount == $products.size())
                <li class="li-price">
                    <span class="total">Total Price: <span class="nosto-total-price">£0</span></span>
                    <div class="actions">
                        <button type="submit" title="Add To Basket" class="button button nosto-btn-cart">Add To Basket</button>
                    </div>
                </li>
                #else
                <li class="li-after">
                    <span>+</span>
                </li>
                #end
                #set($imgCount = $imgCount + 1)
                #set($prdCount = $prdCount + 1)
                #end
            </ul>
            <div class="products-bottom-nosto">
                #foreach($product in $products)
                <div class="nosto-product-desc">
                    <div class="nosto-product-desc-block">
                        <input name="nosto-checkBox" hiddenname="check$!product.productId" checked type="checkbox" class="nosto-checkBox" value="$!product.price">
                        <a href="$!product.url" class="nosto-product-name">$!product.name.truncate(70)</a>
                        #if($product.discounted && $props.display.showOldPrice)
                        <a href="$!product.url" class="nosto-product-price">
                        <span class="nosto-oldprice">$!product.listPrice</span>
                        <span class="nosto-newprice">$!product.price</span>
                        </a>
                        #else
                        <a href="$!product.url" class="saa-price">$!product.price</a>
                        #end
                    </div>
                    <input type="hidden" class="nosto-id" id="check$!product.productId" name="qty[$!product.productId]" class="qty input-text" value="1" min="0">
                </div>
                #end
        </form>
        </div>
    </div>
</div>
#end
<script type="text/javascript">
    var doc = _targetWindow.document;
    var j = _targetWindow.jQuery;

    function findTotal( jQuery ) {
        var totalprice = 0;
        _targetWindow.jQuery('input[type="checkbox"]:checked').each(function(){
            var price = _targetWindow.jQuery(this).val();
            var id = _targetWindow.jQuery(this).attr("hiddenname");
            _targetWindow.jQuery('#'+id).val(1);
            var actualPrice = Number(price.replace(/[^0-9\.]+/g,""));
            var decimalPrice = parseFloat(actualPrice);
            totalprice= totalprice + parseFloat(decimalPrice) ;
        });
        var price = parseFloat(totalprice).toFixed(2);
        _targetWindow.jQuery('.nosto-total-price').html("£"+price);
    };

    _targetWindow.jQuery('.nosto-checkBox').on('change', function(e) {
        var totalprice = 0;
        var id = _targetWindow.jQuery(this).attr("hiddenname");
            _targetWindow.jQuery('#'+id).val(0);
            findTotal();
     });

    function mapProduct() {
        var nostoProd = {};
        var nostoProdArr = [].slice.call(doc.querySelector('.nosto_product').children);
        nostoProdArr.forEach(function(attr) {
            var attribute = attr.innerText;
            var name = attr.className;
            nostoProd[name] = attribute;
        });
        return nostoProd;
    };

    function pushProd(products) {
        var nostoNodeItems = doc.querySelectorAll('#$divId .nosto-list-item');
        var nostoArrayItems = Array.prototype.slice.call(nostoNodeItems);
        var nostoItem = nostoArrayItems[0];
        // var nostoItemRibbon = nostoItem.children[0]
        var nostoItemStyle = nostoItem.children[0];
        var nostoItemLink = nostoItem.children[1];
        var nostoBgImg = `
            #nosto-page-product1 .img-0 {
                background-image: url('${products.image_url}');
                background-position: center center;
                background-repeat: no-repeat;
                background-size: contain !important;
            } `;

        // nostoItemRibbon.style.display = "none"
        nostoItemStyle.innerHTML = nostoBgImg;
        nostoItemLink.attributes[1].alt = products.name;
        nostoItemLink.attributes[1].textContent = products.name;

        // product name
        var nostoNodeName = doc.querySelectorAll('#$divId .nosto-product-name');
        var nostoArrayName = Array.prototype.slice.call(nostoNodeName);
        nostoArrayName[0].innerText = products.name;

        // value object
        var nostoNodeValue = doc.querySelectorAll('#$divId .nosto-checkBox');
        var nostoArrayValue = Array.prototype.slice.call(nostoNodeValue);
        nostoArrayValue[0].value = `£${products.price}`;

        // product price
        var nostoNodePrice = doc.querySelectorAll('#$divId .saa-price');
        var nostoArrayPrice = Array.prototype.slice.call(nostoNodePrice);
        // fix price decimals with the 0 if is rounded
        var priceSplitted = products.price.toString().split('.');
        if(products.price.includes('.')) {
            priceSplitted[1].length === 1
            ? nostoArrayPrice[0].innerText = `£${products.price}0`
            : nostoArrayPrice[0].innerText = `£${products.price}`
        }
        else if (products.price === '') {
            nostoArrayPrice[0].innerText = ``
        } else {
            nostoArrayPrice[0].innerText = `£${products.price}.00`
        }

        // product id
        var nostoNodeId = doc.querySelectorAll('#$divId .nosto-id');
        var nostoArrayId = Array.prototype.slice.call(nostoNodeId);
        nostoArrayId[0].name = `qty[${products.product_id}]`;
    };

    _targetWindow.jQuery(doc).ready(function() {
        mapProduct();
        pushProd(mapProduct());
        findTotal();
    });
</script>
